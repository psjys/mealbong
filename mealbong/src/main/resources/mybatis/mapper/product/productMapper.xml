<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 위 코드가 mapper 설정을 하는 코드 -->

<!-- Mapper를 사용하는 Repository의 전체 경로를 적어줘야함. -->
<mapper namespace="com.project.mealbong.product.ProductMapper">

    <!-- 상품 리스트 -->
    <select id="productList" resultType="com.project.mealbong.product.ProductDTO">
        select p.product_number, p.product_name, p.product_price, i.image_file
        from product p left outer join image i
        on p.product_number = i.product_number and i.image_main = "Y"
    </select>

    <select id="imageList" resultType="com.project.mealbong.product.ImageDTO">
        select * from image
        where product_number = #{product_number}
    </select>

    <!-- 상품 상세 -->
    <select id="productDetail" resultType="com.project.mealbong.product.ProductDTO">
        select product_name, product_price, product_serving,
        (select code_desc from code c where p.package_code = c.code_number)package_code,
        (select code_desc from code c where p.level_code = c.code_number)level_code
        from product p
        where product_number = #{product_number}
    </select>

    <!-- 상품 상세 -->
    <insert id="insert">
        insert into product (category_code, product_name, product_price, level_code
        , product_serving, package_code )
        values (#{category_code}, #{product_name}, #{product_price}, #{level_code}
        , #{product_serving}, #{package_code})
    </insert>
    <!-- 상품 수정 위한 detail -->
    <select id="detail" resultType="com.project.mealbong.product.ProductDTO">
        select *
        from product
        where product_number = #{product_number}
    </select>

    <!-- 상품 수정 -->
    <update id="update">
        update product set product_name=#{product_name}, product_price=#{product_price},
        category_code=#{category_code}, package_code=#{package_code}, product_serving=#{product_serving},
        level_code=#{level_code}
        where product_number = #{product_number}
    </update>

    <!-- 상품 삭제 -->
    <delete id="delete">
        delete from product
        where product_number = #{product_number}
    </delete>

<!--    admin page -->
    <select id="productAdmin" resultType="com.project.mealbong.product.ProductDTO">
        select p.product_number, p.product_name, p.product_price, p.category_code,p.package_code,
               p.product_serving, p.level_code, i.image_file
        from product p, image i
        where p.product_number = i.product_number
    </select>

</mapper>